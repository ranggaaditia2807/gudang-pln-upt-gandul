<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Gudang PLN</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f4f6f9;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .card-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        .card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            width: 250px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card h2 {
            margin: 10px 0;
            font-size: 2em;
            color: #007bff;
        }
        .card p {
            margin: 0;
            font-size: 1.1em;
            color: #555;
        }
    </style>
</head>
<body>

    <h1>Dashboard Gudang PLN</h1>

    <div class="card-container">
        <div class="card">
            <p>Total Item</p>
            <h2 id="totalItem">0</h2>
        </div>
        <div class="card">
            <p>Total Pemasukan</p>
            <h2 id="totalPemasukan">0</h2>
        </div>
        <div class="card">
            <p>Total Pengeluaran</p>
            <h2 id="totalPengeluaran">0</h2>
        </div>
    </div>

    <script>
    // ================= CONFIG JS ===================
    const DATA_CONFIG = {
        STORAGE_KEYS: {
            BARANG: 'barang',
            TRANSAKSI_PEMASUKAN: 'transaksiPemasukan',
            TRANSAKSI_PENGELUARAN: 'transaksiPengeluaran',
            LAPORAN: 'laporan'
        },
        
        DEFAULT_BARANG: [
            { kode: 'BRG001', nama: 'Laptop Dell', stok: 10, satuan: 'unit', lokasi: 'Rak A1' },
            { kode: 'BRG002', nama: 'Mouse Wireless', stok: 5, satuan: 'pcs', lokasi: 'Rak B2' },
            { kode: 'BRG003', nama: 'Keyboard Mechanical', stok: 2, satuan: 'pcs', lokasi: 'Rak B3' }
        ],
        
        getDataBarang: function() {
            return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.BARANG)) || [];
        },
        saveDataBarang: function(barang) {
            localStorage.setItem(this.STORAGE_KEYS.BARANG, JSON.stringify(barang));
        },
        initData: function() {
            if (!localStorage.getItem(this.STORAGE_KEYS.BARANG)) {
                this.saveDataBarang(this.DEFAULT_BARANG);
                console.log("Data barang diinisialisasi dengan data default");
            }
        },
        sinkronisasiStok: function() {
            const barang = this.getDataBarang();
            const transaksiPemasukan = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.TRANSAKSI_PEMASUKAN)) || [];
            const transaksiPengeluaran = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.TRANSAKSI_PENGELUARAN)) || [];
            
            const stokBaru = barang.map(item => {
                let stokAkhir = item.stok;
                transaksiPemasukan.forEach(transaksi => {
                    transaksi.barang.forEach(barangTransaksi => {
                        if (barangTransaksi.kodeBarang === item.kode) {
                            stokAkhir += barangTransaksi.jumlahMasuk || 0;
                        }
                    });
                });
                transaksiPengeluaran.forEach(transaksi => {
                    transaksi.barang.forEach(barangTransaksi => {
                        if (barangTransaksi.kodeBarang === item.kode) {
                            stokAkhir -= barangTransaksi.jumlahKeluar || 0;
                        }
                    });
                });
                return { ...item, stok: Math.max(0, stokAkhir) };
            });
            this.saveDataBarang(stokBaru);
            return stokBaru;
        },
        updateStokBarang: function(kodeBarang, jumlah, jenis) {
            const barang = this.getDataBarang();
            const itemIndex = barang.findIndex(b => b.kode === kodeBarang);
            if (itemIndex === -1) return false;
            if (jenis === 'pengeluaran') barang[itemIndex].stok -= jumlah;
            else if (jenis === 'pemasukan') barang[itemIndex].stok += jumlah;
            barang[itemIndex].stok = Math.max(0, barang[itemIndex].stok);
            this.saveDataBarang(barang);
            return true;
        },
        getTotalBarang: function() {
            const barang = this.getDataBarang();
            return barang.reduce((total, item) => total + (item.stok || 0), 0);
        },
        getTotalPemasukan: function() {
            const transaksiPemasukan = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.TRANSAKSI_PEMASUKAN)) || [];
            let total = 0;
            transaksiPemasukan.forEach(transaksi => {
                transaksi.barang.forEach(b => { total += b.jumlahMasuk || 0; });
            });
            return total;
        },
        getTotalPengeluaran: function() {
            const transaksiPengeluaran = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.TRANSAKSI_PENGELUARAN)) || [];
            let total = 0;
            transaksiPengeluaran.forEach(transaksi => {
                transaksi.barang.forEach(b => { total += b.jumlahKeluar || 0; });
            });
            return total;
        }
    };

    // Inisialisasi dan tampilkan dashboard
    document.addEventListener('DOMContentLoaded', function() {
        DATA_CONFIG.initData();
        document.getElementById("totalItem").textContent = DATA_CONFIG.getTotalBarang();
        document.getElementById("totalPemasukan").textContent = DATA_CONFIG.getTotalPemasukan();
        document.getElementById("totalPengeluaran").textContent = DATA_CONFIG.getTotalPengeluaran();
    });

    window.DataConfig = DATA_CONFIG;
    </script>

</body>
</html>
